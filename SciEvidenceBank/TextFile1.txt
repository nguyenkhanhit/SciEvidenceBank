<div class="evidence-page" style="background:var(--page-bg);min-height:720px;color:var(--text);padding:24px;">
    <div style="display:flex;gap:18px;">
        <div>
            @Html.Partial("_Sidebar")
        </div>

        <div style="flex:1;">
            <div class="page-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;">
                <h2>Dẫn chứng khoa học</h2>

                <form method="get" action="@Url.Action("Index","Evidence")" style="display:flex;gap:8px;align-items:center;">
                    <input type="text" name="q" id="searchBox" value="@Html.Raw(Html.Encode(currentQuery))" placeholder="Tìm kiếm..." style="padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);width:320px;" />
                    <button type="submit" class="btn-primary-theme">Tìm</button>
                </form>
            </div>

            <div id="evidenceList">
                @if (Model != null && Model.Any())
                {
                    foreach (var e in Model)
                    {
                        @Html.Partial("_EvidenceCard", e)
                    }
                }
                else
                {
                    <div class="empty" style="padding:24px;background:var(--muted-surface);border-radius:8px;color:var(--muted-text);">
                        Không có kết quả.
                    </div>
                }
            </div>
            <div style="width:340px;">
                <div style="padding:12px;background:var(--muted-surface);border-radius:8px;margin-bottom:16px;">
                    <h4 style="margin:0 0 8px 0;">Gợi ý cho bạn</h4>

                    @if (recommendations != null && recommendations.Any())
                    {
                        foreach (var r in recommendations)
                        {
                            <div style="margin-bottom:10px;padding-bottom:8px;border-bottom:1px dashed rgba(0,0,0,0.04);">
                                <a href="@Url.Action("Details","Evidence", new { id = r.Id })" style="font-weight:600;color:inherit;text-decoration:none;">
                                    @Html.Raw(r.Title)
                                </a>
                                <div style="font-size:12px;color:var(--muted-text);margin-top:4px;">
                                    @Html.Raw(r.Category?.Name) @if (r.LikesCount > 0)
                                    {<text> · @r.LikesCount lượt thích</text>}
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div style="color:var(--muted-text);">Không có gợi ý. Cập nhật __Interests > Select__ để nhận khuyến nghị.</div>
                    }
                </div>

                <div style="padding:12px;background:var(--muted-surface);border-radius:8px;">
                    <h4 style="margin:0 0 8px 0;">Trích dẫn của bạn</h4>

                    @if (User?.Identity?.IsAuthenticated == true)
                    {
                        if (userCitations != null && userCitations.Any())
                        {
                            foreach (var item in userCitations)
                            {
                                var cit = item.Citation;
                                var ev = item.Evidence;
                                <div style="margin-bottom:12px;">
                                    <a href="@Url.Action("Details","Evidence", new { id = ev.Id })" style="font-weight:600;color:inherit;text-decoration:none;">
                                        @Html.Raw(ev.Title)
                                    </a>
                                    <div style="font-size:12px;color:var(--muted-text);margin-top:4px;">
                                        <strong>@Html.Raw(cit.Style)</strong>
                                        @if (!string.IsNullOrWhiteSpace(cit.CitationText))
                                        {
                                            <div>@Html.Raw(cit.CitationText)</div>
                                        }
                                    </div>
                                </div>
                            }
                            <div style="margin-top:6px;">
                                <a href="@Url.Action("Index", "MyCitations")">Xem tất cả trích dẫn</a>
                            </div>
                        }
                        else
                        {
                            <div style="color:var(--muted-text);">Bạn chưa tạo trích dẫn nào. Vào một dẫn chứng và chọn "Create citation".</div>
                        }
                    }
                    else
                    {
                        <div style="color:var(--muted-text);">Đăng nhập để xem trích dẫn của bạn.</div>
                    }
                </div>
            </div>
        </div>
    </div>
    </div>