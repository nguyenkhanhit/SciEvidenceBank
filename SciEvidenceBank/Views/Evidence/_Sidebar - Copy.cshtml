@using System.Collections
@{
    var categories = ViewBag.Categories as IEnumerable;
    var topLiked = ViewBag.TopLiked as IEnumerable;
    var topCited = ViewBag.TopCited as IEnumerable;

    Func<object, string, object> GetProp = (obj, name) =>
    {
        if (obj == null) return null;
        var prop = obj.GetType().GetProperty(name);
        return prop != null ? prop.GetValue(obj, null) : null;
    };

    string Truncate(object value, int max = 80)
    {
        if (value == null) return string.Empty;
        var s = value.ToString();
        return s.Length <= max ? s : s.Substring(0, max - 1) + "…";
    }
}
<div class="sidebar-surface category-box p-4">
    <h4 style="margin-top: 0; color: var(--primary-800);border-top-left-radius:10px;border-top-right-radius:10px;padding:6px 8px; background-color: #c5d8ff;"><i class="fa-solid fa-list"></i> Danh mục</h4>
    <ul style="list-style:none;padding:0;margin:0;">
        <li style="padding:8px 6px;"><a href="@Url.Action("Index","Evidence")" style="color:var(--primary);text-decoration:none;"><i class="fa-solid fa-layer-group"></i> Tất cả danh mục</a></li>
        @if (categories != null)
        {
            foreach (dynamic c in categories)
            {
                <li style="padding:8px 6px;"><a href="@Url.Action("Index","Evidence", new { categoryId = (int)c.Id })" style="color:var(--primary);text-decoration:none;"><i class="fa-solid fa-book-open"></i> @c.Name</a></li>
            }
        }
    </ul>

    <div style="margin-top:16px;padding:12px;background:var(--surface);border-radius:8px;">
        <h5 style="margin:0 0 8px 0;color:var(--primary-800);">Được Yêu thích Nhất</h5>
        @if (topLiked != null)
        {
            <ul style="list-style:none;padding:0;margin:0;font-size:13px;color:var(--primary);">
                @foreach (var item in topLiked)
                {
                    var id = GetProp(item, "Id");
                    var title = Truncate(GetProp(item, "Title"));
                    var likes = GetProp(item, "LikesCount") ?? GetProp(item, "LikeCount") ?? 0;
                    <li style="padding:8px 6px;border-bottom:1px dashed rgba(0,0,0,0.06);">
                        <a href="@Url.Action("Details","Evidence", new { id = id })" style="color:var(--primary);text-decoration:none;font-weight:500;">@title</a>
                        <div style="margin-top:6px;color:var(--muted-text);font-size:12px;">❤ @likes lượt thích</div>
                    </li>
                }
            </ul>
        }
        else
        {
            <div style="color:var(--muted-text);font-size:13px;">Không có dữ liệu.</div>
        }
    </div>

    <div style="height:12px;"></div> <!-- separator space -->

    <div style="margin-top:0;padding:12px;background:var(--surface);border-radius:8px;">
        <h5 style="margin:0 0 8px 0;color:var(--primary-800);">Được Trích dẫn Nhiều Nhất</h5>
        @if (topCited != null)
        {
            <ul style="list-style:none;padding:0;margin:0;font-size:13px;color:var(--primary);">
                @foreach (var item in topCited)
                {
                    var id = GetProp(item, "Id");
                    var title = Truncate(GetProp(item, "Title"));
                    var cites = GetProp(item, "CitationCount") ?? GetProp(item, "CitationsCount") ?? 0;
                    <li style="padding:8px 6px;border-bottom:1px dashed rgba(0,0,0,0.06);">
                        <a href="@Url.Action("Details","Evidence", new { id = id })" style="color:var(--primary);text-decoration:none;font-weight:500;">@title</a>
                        <div style="margin-top:6px;color:var(--muted-text);font-size:12px;">🔁 @cites trích dẫn</div>
                    </li>
                }
            </ul>
        }
        else
        {
            <div style="color:var(--muted-text);font-size:13px;">Không có dữ liệu.</div>
        }
    </div>
</div>